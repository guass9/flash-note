# Runtime environment: dev | prod
APP_ENV=dev

# In prod, APP_SECRET_KEY / APP_LOGIN_USERNAME / APP_LOGIN_PASSWORD are required.
# APP_LOGIN_USERNAME / APP_LOGIN_PASSWORD are bootstrap credentials synced into users.json.
APP_SECRET_KEY=replace-with-a-long-random-secret
APP_LOGIN_USERNAME=replace-with-bootstrap-username
APP_LOGIN_PASSWORD=replace-with-strong-bootstrap-password
APP_PASSWORD_HASH_ITERATIONS=210000
# bootstrap sync mode:
# - sync: always force APP_LOGIN_* into users.json on startup (compatible with old behavior)
# - create_only: only auto-create when missing, never overwrite existing user
# - disabled: do not auto-manage bootstrap user
#   when disabled in prod, APP_LOGIN_USERNAME/APP_LOGIN_PASSWORD can be left empty
APP_AUTH_BOOTSTRAP_SYNC_MODE=create_only

# Set to 1 when serving over HTTPS.
SESSION_COOKIE_SECURE=0
SESSION_COOKIE_SAMESITE=Lax
# Auto logout when no interaction for this many seconds (default 1 hour).
APP_SESSION_IDLE_TIMEOUT_SEC=3600

# CORS: empty means same-origin only (recommended). Use comma-separated origins when needed.
APP_CORS_ALLOW_ORIGINS=
APP_CORS_ALLOW_CREDENTIALS=1

# Data storage backend (item 11)
APP_STORAGE_BACKEND=sqlite
APP_SQLITE_DB_FILE=/root/flash-note/data/flash_note.db
APP_SQLITE_TIMEOUT_SEC=5.0
APP_SQLITE_ENABLE_FTS=1
APP_SQLITE_OPTIMIZE_WITH_ANALYZE=0
APP_SQLITE_OPTIMIZE_BUSY_TIMEOUT_MS=5000
APP_SQLITE_VACUUM_ENABLED=0
APP_SQLITE_VACUUM_MIN_DB_SIZE_MB=128
APP_SQLITE_VACUUM_MIN_RECLAIM_MB=16
APP_SQLITE_VACUUM_FRAGMENTATION_RATIO_THRESHOLD=0.20
APP_NOTES_QUERY_CACHE_TTL_SEC=8
APP_NOTES_QUERY_CACHE_MAX_ENTRIES=256
APP_NOTES_QUERY_CACHE_SWEEP_INTERVAL_SEC=60
# /api/notes?limit=... server-side cap
APP_NOTES_LIST_MAX_LIMIT=200

# Backup / restore drill (item 12)
APP_BACKUP_DIR=/root/flash-note/backups
APP_BACKUP_RETAIN_DAYS=30
APP_BACKUP_RETAIN_COUNT=30
APP_BACKUP_INCLUDE_ENV=1

# Data lifecycle / capacity policy (item 10)
# report-only by default; set APP_LIFECYCLE_APPLY=1 to enable archive execution.
APP_LIFECYCLE_APPLY=0
APP_LIFECYCLE_ARCHIVE_DAYS=365
APP_LIFECYCLE_ARCHIVE_BATCH_SIZE=500
APP_LIFECYCLE_DELETE_AFTER_ARCHIVE=0
APP_LIFECYCLE_ARCHIVE_DIR=/root/flash-note/data/archive
APP_LIFECYCLE_ARCHIVE_RETAIN_DAYS=365
APP_LIFECYCLE_ARCHIVE_RETAIN_COUNT=24
APP_LIFECYCLE_DATA_WARN_MB=2048
APP_LIFECYCLE_BACKUP_WARN_MB=4096

# Login anti-bruteforce
APP_LOGIN_RATE_LIMIT_WINDOW_SEC=300
APP_LOGIN_RATE_LIMIT_MAX_ATTEMPTS=8
APP_LOGIN_RATE_LIMIT_BLOCK_SEC=600
APP_LOGIN_RATE_LIMIT_BACKEND=memory
APP_LOGIN_RATE_LIMIT_KEY_PREFIX=shunnian:login_rl
APP_REDIS_URL=redis://127.0.0.1:6379/0
APP_REDIS_SOCKET_TIMEOUT_SEC=1.0

# Health watchdog / alert baseline (item 6)
APP_HEALTHCHECK_URL=https://127.0.0.1/healthz
APP_HEALTHCHECK_TIMEOUT_SEC=5.0
# For self-signed TLS on local host, keep verify off by default.
APP_HEALTHCHECK_VERIFY_TLS=0
APP_HEALTHCHECK_EXPECTED_STATUS=ok
APP_HEALTHCHECK_REQUIRE_NGINX=1
APP_ALERT_WEBHOOK_URL=
APP_ALERT_MIN_INTERVAL_SEC=600
APP_ALERT_NOTIFY_RECOVERY=1

# Optional Gunicorn tuning
# Recommended with Nginx reverse proxy: 127.0.0.1:5000
# If you need direct external access to Gunicorn, change to 0.0.0.0:5000.
GUNICORN_BIND=127.0.0.1:5000
GUNICORN_WORKERS=2
GUNICORN_THREADS=2
GUNICORN_TIMEOUT=60
APP_LOG_LEVEL=INFO

# Server
PORT=5000
FLASK_DEBUG=0
